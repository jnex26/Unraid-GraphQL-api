

# Unraid-GraphQL-api
This is the start of a Simple API Interface for Unraid,

How to Use

Download and put all the files into your Libraries Folder under UnraidGraph

Make sure you are using the ESP32 Boards from Boards Manager as it's using the ESP32 http client 

it's only using plaintext http at the moment, I will introduce secure at some point, but at the moment my unraid does not have a cert. 

you will also need the following Libaries installed these are used HEAVILY and I will need to update the objects at somepoint from DyanmicjosnDocument.. 

```
#include <ArduinoJson.h>
#include <String.h>
```

Connect to your Wifi Network.... 

note on the S3 I needed to reduce the wifi power with WiFi.setTxPower(WIFI_POWER_8_5dBm);

once your connected ( i would really make sure you have a trap for connection failure as the library has no error checking ) 

Load the Class 


`UnraidGraph unraid ;


if you want noisy output to the Serial connection ( Remember to use Serial.Begin(bps)) and set the serial mode in the IDE. 
'''
unraid.debug(true); // Allows a more verbose output to serial connection it defaults to off. 
'''
run the initaliasation with the begin function, you don't need to end it's only a trap for setting the internal authentication varibles; 
'''
unraid.begin(<URL>,<KEY>);
'''
the url is the full URL at the moment it's running http and only supports that (for now, the libaries are loaded i just need to trap the method and allow for Cert fingerprint )

the Key is the key generated by unraid api function. unraid-api apikey --create , I am only running a read-only schema rather than read-write, so when setting up your key select admin then only read permissions. 

create a object to store the resultset ( keeping in mind that someone with ALLOT of Dockers should use S3 and store this object in OPI ram)
'''
JsonDocument tempdoc;
'''
Then you can make the call, this will run a number of internal functions and normally spitout a valid and processable JSON file. 
'''
tempdoc = unraid.getUnraidMemory();
'''
from there you can handle the resultset as a normal json object.

These are pre-canned queries and depending on your unraid server these can be pretty big (See OPI comment earlier)
'''
tempdoc = unraid.getUnraidParityHistory();
tempdoc = unraid.getUnraidArrayParity();
tempdoc = unraid.getUnraidArrayDisks();
tempdoc = unraid.getUnraidContainers();
tempdoc = unraid.getUnraidArrayCapacity();
tempdoc = unraid.getUnraidDisks();
tempdoc = unraid.getUnraidMemory();
tempdoc = unraid.getUnraidVMs();
'''
There are some other functions too. 
'''
tempdoc = unraid.returnGraphQuery(JsonObject formatted Like Graph )
'''
Note on the Above you need the child nodes to read :true as it uses that as the identifier to format the object. 

returnGraphQuery <-- this is the REALLY REALLY Janky modification of a Json Object that converts it into a GraphQL query, they they could not have kept with JSON !!! 

getGraph <-- This is there I build the HTTP connection and setup the post there is allot more to do here. 

So My code looks like this 
'''
  Serial.begin(115200);
  delay(1000);
  unraid.begin(unraidapi,unraidapiey);
  unraid.debug(false);
  Serial.print("Hello! World");
  configureWifi();
  JsonDocument tempdoc2;
  tempdoc2 = unraid.getUnraidMemory();
  serializeJson(tempdoc2,Serial);

'''
tested on ESP32-S3 ESP32-C3... 


Notes on the creds.h file. needs to look like below. 

```
#ifndef STASSID                        // either use an external .h file containing STASSID and STAPSK - or 
//                                     // add defines to your boards - or
#define STASSID "<YOUR SSID HERE>"            // ... modify these line to your SSID
#define STAPSK  "<YOUR PASSWORD HERE >"        // ... and set your WIFI password
#define UNRAIDAPI "<YOUR UNRAID API KEY HERE" // just the Key. 
#define UNRAIDURL "<YOUR UNRAID GRAPHQL LOCATION HERE> " // this is the full URL 
#endif

const char* ssid = STASSID;
const char* password = STAPSK;
const char* unraidapiey = UNRAIDAPI;
const char* unraidapi = UNRAIDURL;
```
